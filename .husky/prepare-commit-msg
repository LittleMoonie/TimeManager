#!/usr/bin/env bash
# ðŸ§± Husky prepare-commit-msg â€” GoGoTime
# Auto-insert Conventional Commit template if message is empty
# Skips merge/squash commits

set -euo pipefail

MSGFILE="$1"
SOURCE="${2:-}"

# Ignore merge/squash commits
case "$SOURCE" in
  merge|squash) exit 0 ;;
esac

# If a message already exists (e.g. via -m), skip
[ -s "$MSGFILE" ] && exit 0

# --- Smart scope detection (optional)
# Detect if commit affects App.Web or App.API
scope="core"
if git diff --cached --name-only | grep -q '^App\.Web/'; then
  scope="web"
elif git diff --cached --name-only | grep -q '^App\.API/'; then
  scope="api"
fi

# --- Insert template at top
{
  echo "feat(${scope}): short summary"
  echo ""
  echo "What:"
  echo "- Describe what changed"
  echo ""
  echo "Why:"
  echo "- Explain the motivation"
  echo ""
  echo "How:"
  echo "- Summarize how it was done"
  echo ""
  echo "Impact:"
  echo "- Mention side effects or implications"
  echo ""
  echo ""
  cat "$MSGFILE" 2>/dev/null || true
} > "${MSGFILE}.tmp" && mv "${MSGFILE}.tmp" "$MSGFILE"
