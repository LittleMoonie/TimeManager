# üê≥ GoGoTime API - Dev Dockerfile
FROM node:24-alpine AS base

# 1Ô∏è‚É£ Build tools
RUN apk add --no-cache curl g++ make python3

WORKDIR /app

# 2Ô∏è‚É£ Pin Yarn
RUN corepack enable && corepack prepare yarn@stable --activate

# Copy dependency manifests first (cache layer)
COPY App.API/yarn.lock ./
COPY App.API/package.json ./

# 4Ô∏è‚É£ Install dependencies (immutable but safe fallback)
RUN yarn install --immutable || yarn install

# 5Ô∏è‚É£ Copy source
COPY . .

# 6Ô∏è‚É£ Expose API port
ENV NODE_ENV=development
EXPOSE 4000

# 7Ô∏è‚É£ Default dev command
CMD ["yarn", "dev"]
